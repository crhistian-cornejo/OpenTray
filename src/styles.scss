// ============================================
// OpenTray Styles
// ============================================

// --------------------------------------------
// Variables & Theme
// --------------------------------------------
:root {
  // Colors - Light theme (default)
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f7;
  --bg-tertiary: #e8e8ed;
  --text-primary: #1d1d1f;
  --text-secondary: #86868b;
  --text-tertiary: #aeaeb2;
  --text-weak: #98989d;
  --text-weaker: #636366;
  --text-strong: #000000;
  --text-interactive: #034cff;
  --border-color: #d2d2d7;
  --border-interactive: #034cff;
  --border-success: #12c905;
  --border-warning: #ffdc17;
  --border-error: #fc533a;
  --accent-color: #034cff;
  --success-color: #12c905;
  --warning-color: #ffdc17;
  --error-color: #fc533a;
  
  // Surface colors (OpenCode style)
  --surface-base: #f8f7f7;
  --surface-hover: rgba(5, 0, 0, 0.06);
  --surface-active: rgba(0, 0, 0, 0.1);
  --surface-raised: #ffffff;
  --surface-inset: rgba(0, 0, 0, 0.02);
  
  // Shadows
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
  
  // Radius
  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 14px;
}

// Dark theme - Auto
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) {
    --bg-primary: #1c1c1e;
    --bg-secondary: #2c2c2e;
    --bg-tertiary: #3a3a3c;
    --text-primary: #f5f5f7;
    --text-secondary: #98989d;
    --text-tertiary: #636366;
    --text-weak: #86868b;
    --text-weaker: #636366;
    --text-strong: #ffffff;
    --text-interactive: #034cff;
    --border-color: #38383a;
    --border-interactive: #034cff;
    --border-success: #12c905;
    --border-warning: #ffdc17;
    --border-error: #fc533a;
    --surface-base: #1c1c1e;
    --surface-hover: rgba(224, 183, 183, 0.09);
    --surface-active: rgba(0, 0, 0, 0.1);
    --surface-raised: #2c2c2e;
    --surface-inset: rgba(14, 11, 11, 0.5);
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
  }
}

// Dark theme - Forced
:root[data-theme="dark"] {
    --bg-primary: #1c1c1e;
    --bg-secondary: #2c2c2e;
    --bg-tertiary: #3a3a3c;
    --text-primary: #f5f5f7;
    --text-secondary: #98989d;
    --text-tertiary: #636366;
    --text-weak: #86868b;
    --text-weaker: #636366;
    --text-strong: #ffffff;
    --text-interactive: #034cff;
    --border-color: #38383a;
    --border-interactive: #034cff;
    --border-success: #12c905;
    --border-warning: #ffdc17;
    --border-error: #fc533a;
    --surface-base: #1c1c1e;
    --surface-hover: rgba(224, 183, 183, 0.09);
    --surface-active: rgba(0, 0, 0, 0.1);
    --surface-raised: #2c2c2e;
    --surface-inset: rgba(14, 11, 11, 0.5);
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
  }

// Light theme - Forced
:root[data-theme="light"] {
    --bg-primary: #ffffff;
    --bg-secondary: #f5f5f7;
    --bg-tertiary: #e8e8ed;
    --text-primary: #1d1d1f;
    --text-secondary: #86868b;
    --text-tertiary: #aeaeb2;
    --text-weak: #98989d;
    --text-weaker: #636366;
    --text-strong: #000000;
    --text-interactive: #034cff;
    --border-color: #d2d2d7;
    --border-interactive: #034cff;
    --border-success: #12c905;
    --border-warning: #ffdc17;
    --border-error: #fc533a;
    --surface-base: #f8f7f7;
    --surface-hover: rgba(5, 0, 0, 0.06);
    --surface-active: rgba(0, 0, 0, 0.1);
    --surface-raised: #ffffff;
    --surface-inset: rgba(0, 0, 0, 0.02);
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

// --------------------------------------------
// Reset & Base
// --------------------------------------------
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  height: 100%;
  width: 100%;
  overflow: hidden;
  max-width: 100vw;
  background: transparent;
}

#root {
  height: 100%;
  width: 100%;
  overflow: visible;
}

body {
  font-family: "Inter", "Inter Fallback", -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  font-size: 13px;
  line-height: 1.4;
  color: var(--text-primary);
  background: transparent;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  user-select: none;
  border-radius: 10px;
  overflow: hidden;
}

// Scrollbar
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--text-tertiary);
  border-radius: 3px;
  
  &:hover {
    background: var(--text-secondary);
  }
}

// --------------------------------------------
// Animations
// --------------------------------------------
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes statusPulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(1.2); }
}

@keyframes modePulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(1.02); }
}

@keyframes modeIconBounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-1px); }
}

.fade-in { animation: fadeIn 0.2s ease-out; }
.pulse { animation: pulse 1.5s ease-in-out infinite; }
.spin { animation: spin 1s linear infinite; }

// --------------------------------------------
// Layout
// --------------------------------------------
.app {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--bg-primary);
  overflow: visible;
  max-width: 100%;
  position: relative;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 0 0 1px var(--border-color);
  
  // Arrow pointing to tray icon - fixed position from right edge
  // Hide arrow on Windows
  &:not(.is-windows)::before {
    content: '';
    position: absolute;
    top: -8px;
    right: 175px; // Fixed position to align with tray icon
    width: 16px;
    height: 8px;
    background: var(--bg-secondary);
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
    z-index: 1001;
  }
  
  // Arrow border
  // Hide arrow border on Windows
  &:not(.is-windows)::after {
    content: '';
    position: absolute;
    top: -9px;
    right: 174px; // Fixed position to align with tray icon
    width: 18px;
    height: 9px;
    background: var(--border-color);
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
    z-index: 1000;
  }
}

.content {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  max-width: 100%;
  border-radius: 0 0 10px 10px;
}

// --------------------------------------------
// Header
// --------------------------------------------
.header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 16px;
  border-bottom: 1px solid var(--border-color);
  background: var(--bg-secondary);
  border-radius: 10px 10px 0 0;
  -webkit-app-region: drag;
  
  &-btn {
    -webkit-app-region: no-drag;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    padding: 0;
    border: none;
    border-radius: var(--radius-sm);
    background: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.15s ease;
    position: relative;
    
    &:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    
    // Primary button style (e.g., New Session)
    &-primary {
      background: var(--accent-color);
      color: white;
      
      &:hover {
        background: var(--accent-color);
        filter: brightness(1.1);
        color: white;
      }
    }
    
    // Tooltip
    &[data-tooltip] {
      &::after {
        content: attr(data-tooltip);
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(4px);
        padding: 4px 8px;
        font-size: 11px;
        font-weight: 500;
        white-space: nowrap;
        color: var(--text-primary);
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        box-shadow: var(--shadow-md);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.15s ease, transform 0.15s ease;
        z-index: 1000;
      }
      
      &::before {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 4px solid transparent;
        border-right: 4px solid transparent;
        border-bottom: 4px solid var(--bg-tertiary);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.15s ease, transform 0.15s ease;
        z-index: 1001;
      }
      
      &:hover::after {
        opacity: 1;
        transform: translateX(-50%) translateY(6px);
      }
      
      &:hover::before {
        opacity: 1;
        transform: translateX(-50%) translateY(2px);
      }
    }
  }
  
  &-title {
    flex: 1;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  &-actions {
    display: flex;
    gap: 4px;
    -webkit-app-region: no-drag;
  }
}

.badge {
  position: absolute;
  top: 2px;
  right: 2px;
  min-width: 14px;
  height: 14px;
  padding: 0 4px;
  font-size: 10px;
  font-weight: 600;
  line-height: 14px;
  text-align: center;
  color: white;
  background: var(--accent-color);
  border-radius: 7px;
}

// --------------------------------------------
// List Items
// --------------------------------------------
.list {
  display: flex;
  flex-direction: column;
}

.list-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  border: none;
  border-bottom: 1px solid var(--border-color);
  background: transparent;
  cursor: pointer;
  text-align: left;
  transition: background 0.15s ease;
  width: 100%;

  &:hover { background: var(--bg-secondary); }
  &:active { background: var(--bg-tertiary); }
  
  &.new-session-btn {
    background: var(--bg-secondary);
    border-bottom-width: 2px;
    
    .list-item-icon {
      background: var(--accent-color);
      color: white;
    }
    
    .list-item-title {
      color: var(--accent-color);
    }
  }
  
  &-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: var(--radius-md);
    background: var(--bg-tertiary);
  }
  
  &-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 2px;
    overflow: hidden;
  }

  &-title {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  &-subtitle {
    font-size: 11px;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  &-meta {
    font-size: 11px;
    color: var(--text-tertiary);
    font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
    flex-shrink: 0;
    white-space: nowrap;
    text-align: right;
    min-width: 60px;
  }
}

// --------------------------------------------
// Status
// --------------------------------------------
.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--text-tertiary);
  
  &.connected { background: var(--success-color); }
}

// --------------------------------------------
// Loading & Empty States
// --------------------------------------------
.loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 48px 24px;
  color: var(--text-secondary);
}

.spinner {
  width: 24px;
  height: 24px;
  border: 2px solid var(--border-color);
  border-top-color: var(--accent-color);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

.empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 48px 24px;
  text-align: center;
  
  &-icon {
    color: var(--text-tertiary);
    margin-bottom: 8px;
  }
  
  p {
    font-size: 13px;
    color: var(--text-secondary);
  }
  
  &-hint {
    font-size: 11px;
    color: var(--text-tertiary);
  }
}

// --------------------------------------------
// Chat
// --------------------------------------------
.chat {
  display: flex;
  flex-direction: column;
  height: 100%;
  
  &-messages {
    flex: 1;
    overflow-y: auto;
    padding: 12px 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  &-input {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 12px 16px;
    border-top: 1px solid var(--border-color);
    background: var(--bg-secondary);
    position: relative;
    
    input {
      flex: 1;
      height: 36px;
      padding: 0 12px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 13px;
      outline: none;
      transition: border-color 0.15s ease;
      
      &:focus { border-color: var(--accent-color); }
      &::placeholder { color: var(--text-tertiary); }
    }
  }
}

.message {
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: 10px 12px;
  border-radius: var(--radius-md);
  background: var(--bg-secondary);
  
  &.user {
    background: var(--accent-color);
    
    .message-header,
    .message-content { color: white; }
  }
  
  &-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  &-role {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.02em;
  }
  
  &-time {
    font-size: 10px;
    color: var(--text-tertiary);
  }
  
  &-content {
    font-size: 13px;
    color: var(--text-primary);
    line-height: 1.5;
  }
  
  &-text {
    font-size: 13px;
    line-height: 1.6;
    max-width: 100%;
    overflow-wrap: break-word;
    word-break: break-word;
    
    p {
      margin: 0 0 8px 0;
      &:last-child { margin-bottom: 0; }
    }
    
    code {
      font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
      font-size: 12px;
      padding: 2px 4px;
      background: var(--bg-tertiary);
      border-radius: 3px;
    }
    
    pre {
      margin: 8px 0;
      padding: 10px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      overflow-x: auto;
      max-width: 100%;
      
      code {
        padding: 0;
        background: none;
      }
    }
    
    ul, ol {
      margin: 8px 0;
      padding-left: 20px;
    }
    
    li { margin: 4px 0; }
    
    blockquote {
      margin: 8px 0;
      padding-left: 12px;
      border-left: 2px solid var(--border-color);
      color: var(--text-secondary);
    }
  }
}

.send-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  padding: 0;
  border: none;
  border-radius: var(--radius-md);
  background: var(--accent-color);
  color: white;
  cursor: pointer;
  transition: opacity 0.15s ease;
  
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  &:not(:disabled):hover { opacity: 0.9; }
}

.abort-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  height: 36px;
  border: none;
  border-radius: var(--radius-md);
  background: var(--error-color);
  color: white;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: opacity 0.15s ease;
  
  &:hover { opacity: 0.9; }
}

// Command & Model Suggestions
.command-suggestions,
.model-suggestions {
  position: absolute;
  bottom: 100%;
  left: 16px;
  right: 16px;
  background: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-md);
  max-height: 200px;
  overflow-y: auto;
  margin-bottom: 8px;
}

.model-suggestions { max-height: 300px; }

.suggestions-header {
  padding: 8px 12px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-tertiary);
  border-bottom: 1px solid var(--border-color);
  background: var(--bg-secondary);
}

.command-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 8px 12px;
  border: none;
  background: transparent;
  cursor: pointer;
  text-align: left;
  transition: background 0.1s ease;
  
  &:hover, &.selected { background: var(--bg-tertiary); }
}

.command-name {
  font-size: 13px;
  font-weight: 500;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  color: var(--accent-color);
}

.command-desc {
  font-size: 11px;
  color: var(--text-secondary);
}

.model-item {
  flex-direction: column;
  align-items: flex-start;
  gap: 2px;
}

.model-info {
  display: flex;
  align-items: center;
  gap: 8px;
}

.model-name {
  font-size: 13px;
  font-weight: 500;
  color: var(--text-primary);
}

.model-provider {
  font-size: 11px;
  color: var(--accent-color);
  padding: 1px 6px;
  background: rgba(99, 102, 241, 0.1);
  border-radius: 4px;
}

.model-id {
  font-size: 10px;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  color: var(--text-tertiary);
}

.model-name {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
}

.model-badge {
  font-size: 9px;
  font-weight: 600;
  padding: 2px 5px;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.02em;

  &.current {
    background: rgba(34, 197, 94, 0.15);
    color: var(--success-color);
  }

  &.configured {
    background: rgba(99, 102, 241, 0.15);
    color: var(--accent-color);
  }

  &.reasoning {
    background: rgba(139, 92, 246, 0.15);
    color: #8b5cf6;
  }
}

.model-item.current {
  background: rgba(34, 197, 94, 0.08);
  border-left: 2px solid var(--success-color);
  padding-left: 10px;
}

.model-suggestions {
  .suggestions-header {
    display: flex;
    align-items: center;
    gap: 6px;

    svg {
      color: var(--accent-color);
    }
  }
}

// File Suggestions (@ mentions)
.file-suggestions {
  .suggestions-header {
    display: flex;
    align-items: center;
    gap: 6px;

    svg {
      color: var(--accent-color);
    }
  }
}

.file-item {
  display: flex;
  align-items: center;
  gap: 8px;
}

.file-icon {
  flex-shrink: 0;
  color: var(--text-secondary);
}

.file-path {
  font-size: 12px;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.suggestions-empty {
  padding: 12px;
  font-size: 12px;
  color: var(--text-tertiary);
  text-align: center;
}

// --------------------------------------------
// Tool Calls
// --------------------------------------------
.tool-calls {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-top: 8px;
}

.tool-call {
  border-radius: var(--radius-sm);
  background: var(--bg-tertiary);
  overflow: hidden;
  
  &.status-pending { opacity: 0.7; }
  &.status-running { border-left: 2px solid var(--accent-color); }
  &.status-completed { border-left: 2px solid var(--success-color); }
  &.status-error { border-left: 2px solid var(--error-color); }
}

.tool-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  font-size: 12px;
  width: 100%;
  border: none;
  background: transparent;
  cursor: default;
  text-align: left;
  
  &:not(:disabled) {
    cursor: pointer;
    &:hover { background: rgba(255, 255, 255, 0.05); }
  }
}

.tool-icon {
  font-size: 11px;
  width: 16px;
  text-align: center;
}

.tool-name {
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  font-weight: 500;
  color: var(--text-primary);
}

.tool-title {
  color: var(--text-secondary);
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex: 1;
}

.tool-expand {
  display: flex;
  align-items: center;
  margin-left: auto;
  color: var(--text-tertiary);
  transition: transform 0.15s ease;
  
  &.expanded { transform: rotate(90deg); }
}

.tool-output {
  padding: 8px 10px;
  font-size: 11px;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  background: var(--bg-primary);
  border-top: 1px solid var(--border-color);
  max-height: 200px;
  overflow-y: auto;
  
  pre {
    margin: 0;
    white-space: pre-wrap;
    word-break: break-word;
    color: var(--text-secondary);
  }
}

.tool-error {
  padding: 6px 10px;
  font-size: 11px;
  color: var(--error-color);
  background: rgba(239, 68, 68, 0.1);
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
}

// --------------------------------------------
// Diffs
// --------------------------------------------
.diffs {
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-width: 100%;
  overflow: hidden;
}

.diff-summary {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: var(--bg-secondary);
  border-radius: var(--radius-md);
  margin-bottom: 4px;
  
  &-count {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-primary);
  }
  
  &-stats {
    display: flex;
    gap: 8px;
  }
}

.diff-add {
  color: var(--success-color);
  font-size: 11px;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
}

.diff-del {
  color: var(--error-color);
  font-size: 11px;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  margin-left: 4px;
}

.diff-item {
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  overflow: hidden;
  max-width: 100%;
  background: var(--bg-primary);
}

.diff-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 12px;
  background: var(--bg-secondary);
  border: none;
  cursor: pointer;
  width: 100%;
  text-align: left;
  transition: background 0.15s ease;
  
  &:hover { background: var(--bg-tertiary); }
  
  &-left {
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 0;
    flex: 1;
  }
  
  &-right {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }
}

.diff-expand-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  color: var(--text-secondary);
  transition: transform 0.15s ease;
  transform: rotate(-90deg);
  
  &.expanded { transform: rotate(0deg); }
}

.diff-file-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  font-size: 9px;
  font-weight: 600;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  border-radius: var(--radius-sm);
  flex-shrink: 0;
}

.diff-file-info {
  display: flex;
  flex-direction: column;
  gap: 1px;
  min-width: 0;
}

.diff-file-name {
  font-size: 12px;
  font-weight: 500;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.diff-file-path {
  font-size: 10px;
  color: var(--text-tertiary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.diff-content-wrapper {
  border-top: 1px solid var(--border-color);
}

.diff-content {
  padding: 12px;
  font-size: 11px;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  line-height: 1.5;
  color: var(--text-secondary);
  background: var(--bg-primary);
  white-space: pre-wrap;
  word-break: break-word;
  overflow-wrap: break-word;
  margin: 0;
  max-height: 200px;
  overflow-y: auto;
  overflow-x: hidden;
}

// Diff Viewer
.diff-viewer {
  background: var(--bg-primary);
  overflow: hidden;
  max-width: 100%;
}

.diff-lines {
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  font-size: 11px;
  line-height: 1.6;
  max-height: 300px;
  overflow-y: auto;
  overflow-x: hidden;
}

.diff-line {
  display: flex;
  white-space: pre-wrap;
  word-break: break-word;
  max-width: 100%;
  
  &-header {
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    font-weight: 500;
    padding: 4px 8px;
  }
  
  &-add { background: rgba(34, 197, 94, 0.15); }
  &-remove { background: rgba(239, 68, 68, 0.15); }
  &-context { background: transparent; }
  
  &-prefix {
    width: 16px;
    text-align: center;
    flex-shrink: 0;
    color: var(--text-secondary);
  }
  
  &-content {
    flex: 1;
    padding-right: 8px;
    overflow: hidden;
    word-break: break-word;
    overflow-wrap: break-word;
  }
}

.diff-line-add .diff-line-prefix { color: var(--success-color); }
.diff-line-remove .diff-line-prefix { color: var(--error-color); }

.diff-gutter {
  display: flex;
  flex-shrink: 0;
  width: 52px;
  color: var(--text-tertiary);
  background: var(--bg-secondary);
  border-right: 1px solid var(--border-color);
  user-select: none;
  font-size: 10px;
}

.diff-line-old,
.diff-line-new {
  width: 26px;
  text-align: right;
  padding-right: 4px;
}

.diff-truncated {
  padding: 8px;
  text-align: center;
  font-size: 11px;
  color: var(--text-tertiary);
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-color);
}

// --------------------------------------------
// Modal
// --------------------------------------------
.modal-overlay {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
  background: rgba(0, 0, 0, 0.5);
  z-index: 100;
}

.modal {
  width: 100%;
  max-width: 320px;
  background: var(--bg-primary);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  overflow: hidden;
  
  &-header {
    padding: 16px;
    border-bottom: 1px solid var(--border-color);
    
    h2 {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }
  }
  
  &-content { padding: 16px; }
  
  &-actions {
    display: flex;
    gap: 8px;
    padding: 16px;
    border-top: 1px solid var(--border-color);
  }
}

.permission-type {
  font-size: 13px;
  font-weight: 500;
  color: var(--text-primary);
  margin-bottom: 12px;
}

.permission-patterns {
  display: flex;
  flex-direction: column;
  gap: 4px;
  
  code {
    font-size: 11px;
    font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
    padding: 4px 8px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-sm);
    color: var(--text-secondary);
  }
}

.btn {
  flex: 1;
  height: 32px;
  border: none;
  border-radius: var(--radius-sm);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: opacity 0.15s ease;
  
  &:hover { opacity: 0.9; }
  
  &-deny { background: var(--error-color); color: white; }
  &-once { background: var(--bg-tertiary); color: var(--text-primary); }
  &-always { background: var(--success-color); color: white; }
}

// --------------------------------------------
// Settings
// --------------------------------------------
.settings {
  padding: 12px 16px;
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
  
  &-section {
    margin-bottom: 16px;
    &:last-child { margin-bottom: 0; }
  }
  
  &-section-title {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-tertiary);
    margin: 0 0 12px 0;
  }
  
  &-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-color);
    gap: 12px;
    min-width: 0;

    &:last-child { border-bottom: none; }

    &.clickable {
      cursor: pointer;
      border-radius: var(--radius-sm);
      margin: 0 -8px;
      padding: 10px 8px;
      border: none;
      width: calc(100% + 16px);
      text-align: left;
      background: transparent;

      &:hover { background: var(--bg-tertiary); }
    }
  }

  &-label {
    font-size: 13px;
    color: var(--text-primary);
    flex-shrink: 0;
  }

  &-value {
    font-size: 13px;
    color: var(--text-secondary);
    font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 0;
    text-align: right;
  }
  
  &-control { display: flex; align-items: center; }
  
  &-select {
    appearance: none;
    padding: 6px 28px 6px 10px;
    font-size: 13px;
    color: var(--text-primary);
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M3 5l3 3 3-3'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
    
    &:focus {
      outline: none;
      border-color: var(--accent-color);
    }
  }
  
  &-status {
    display: flex;
    align-items: center;
    gap: 6px;
    text-transform: capitalize;
    
    .status-indicator {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--text-tertiary);
    }
    
    &.connected .status-indicator { background: var(--success-color); }
    &.disconnected .status-indicator { background: var(--error-color); }
    &.error .status-indicator { background: var(--warning-color); }
  }
  
  &-empty {
    padding: 12px 0;
    font-size: 12px;
    color: var(--text-tertiary);
    font-style: italic;
  }
  
  &-tabs {
    display: flex;
    gap: 2px;
    padding: 0 0 12px 0;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 12px;
    flex-shrink: 0;
  }
  
  &-tab {
    flex: 1;
    padding: 8px 12px;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    border-radius: var(--radius-sm);
    transition: all 0.15s ease;
    
    &:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    
    &.active {
      background: var(--accent-color);
      color: white;
    }
  }
  
  &-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding-bottom: 8px;
  }
  
  &-model {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    
    svg { color: var(--text-tertiary); }
  }
  
  &-shortcut {
    font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
    font-size: 11px;
    font-weight: 500;
    padding: 4px 8px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    color: var(--text-primary);
  }

  &-shortcut-input {
    font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
    font-size: 11px;
    font-weight: 500;
    padding: 6px 10px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.15s ease;
    min-width: 100px;
    text-align: center;

    &:hover {
      border-color: var(--accent-color);
      background: var(--bg-secondary);
    }

    &:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(3, 76, 255, 0.2);
    }

    &.editing {
      background: var(--bg-primary);
      border-color: var(--accent-color);
      color: var(--accent-color);
      animation: pulse 1s ease-in-out infinite;
    }
  }
  
  &-hint {
    font-size: 11px;
    color: var(--text-tertiary);
    line-height: 1.5;
    margin: 4px 0 0 0;
    padding: 0;
  }
}

// Toggle Switch
.toggle {
  position: relative;
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  
  input {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }
  
  &-slider {
    position: relative;
    width: 36px;
    height: 20px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    transition: all 0.2s ease;
    
    &::before {
      content: "";
      position: absolute;
      top: 2px;
      left: 2px;
      width: 14px;
      height: 14px;
      background: var(--text-secondary);
      border-radius: 50%;
      transition: all 0.2s ease;
    }
  }
  
  input:checked + &-slider {
    background: var(--accent-color);
    border-color: var(--accent-color);
    
    &::before {
      transform: translateX(16px);
      background: white;
    }
  }
  
  input:focus + &-slider {
    box-shadow: 0 0 0 2px rgba(3, 76, 255, 0.2);
  }
  
  &:hover .toggle-slider {
    border-color: var(--accent-color);
  }
}

// Model Selector
.model-selector {
  margin-top: 8px;
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm);
  overflow: hidden;
  
  &-header {
    padding: 8px 12px;
    font-size: 11px;
    font-weight: 600;
    color: var(--text-tertiary);
    border-bottom: 1px solid var(--border-color);
  }
  
  &-list {
    max-height: 250px;
    overflow-y: auto;
  }
  
  &-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: 10px 12px;
    border: none;
    background: transparent;
    cursor: pointer;
    text-align: left;
    transition: background 0.1s ease;
    
    &:hover { background: var(--bg-primary); }
    &.active { background: rgba(99, 102, 241, 0.15); }
    &:disabled { opacity: 0.5; cursor: not-allowed; }
  }
  
  &-name {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-primary);
  }
  
  &-provider {
    font-size: 11px;
    color: var(--text-tertiary);
  }
}

// Provider List
.provider-list {
  display: flex;
  flex-direction: column;
  gap: 1px;
  margin-top: 8px;
}

.provider-item {
  border-bottom: 1px solid var(--border-color);
  &:last-child { border-bottom: none; }
}

.provider-header {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  padding: 8px 0;
  border: none;
  background: transparent;
  cursor: pointer;
  text-align: left;
  
  &:hover { opacity: 0.8; }
}

.provider-expand {
  display: flex;
  color: var(--text-tertiary);
  transition: transform 0.15s ease;
  
  &.expanded { transform: rotate(90deg); }
}

.provider-name {
  flex: 1;
  font-size: 12px;
  font-weight: 500;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 6px;
}

.provider-custom-badge {
  font-size: 9px;
  font-weight: 600;
  padding: 2px 5px;
  background: rgba(99, 102, 241, 0.2);
  color: var(--accent-color);
  border-radius: 3px;
  text-transform: uppercase;
}

.provider-model-count {
  font-size: 11px;
  color: var(--text-tertiary);
}

.provider-models {
  border-top: 1px solid var(--border-color);
  max-height: 200px;
  overflow-y: auto;
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm);
  margin: 4px 0 8px 20px;
}

.provider-model {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  font-size: 11px;
  border-bottom: 1px solid var(--border-color);
  
  &:last-child { border-bottom: none; }
  
  &-name {
    flex: 1;
    color: var(--text-primary);
  }
  
  &-id {
    color: var(--text-tertiary);
    font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
    font-size: 10px;
  }
  
  &-badge {
    font-size: 9px;
    padding: 2px 4px;
    border-radius: 3px;
    font-weight: 500;
    
    &.reasoning {
      background: rgba(139, 92, 246, 0.15);
      color: #8b5cf6;
    }
  }
}

// MCP List
.mcp-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.mcp-item {
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm);
  padding: 12px;
}

.mcp-header {
  display: flex;
  align-items: center;
  gap: 8px;
}

.mcp-status {
  display: flex;
  align-items: center;
  
  .status-indicator {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--text-tertiary);
  }
  
  &.connected .status-indicator { background: var(--success-color); }
  &.disconnected .status-indicator { background: var(--error-color); }
  &.configured .status-indicator { background: var(--accent-color); }
  &.disabled .status-indicator { background: var(--text-tertiary); }
}

.mcp-name {
  flex: 1;
  font-size: 12px;
  font-weight: 500;
  color: var(--text-primary);
}

.mcp-status-text {
  font-size: 11px;
  color: var(--text-tertiary);
  text-transform: capitalize;
}

.mcp-details {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 6px;
}

.mcp-type {
  font-size: 10px;
  padding: 2px 6px;
  background: var(--bg-primary);
  color: var(--accent-color);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.mcp-url,
.mcp-command {
  font-size: 10px;
  color: var(--text-tertiary);
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
}

.mcp-url {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 200px;
}

.mcp-tools {
  margin-top: 8px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  
  &-label {
    font-size: 10px;
    color: var(--text-tertiary);
    text-transform: uppercase;
  }
  
  &-list {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }
}

.mcp-tool-badge {
  font-size: 10px;
  padding: 2px 6px;
  background: var(--bg-primary);
  color: var(--text-secondary);
  border-radius: 3px;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  
  &.more { color: var(--text-tertiary); }
}

// --------------------------------------------
// Status Bar
// --------------------------------------------
.status-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 12px;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-color);
  font-size: 11px;
  
  &-left, &-right {
    display: flex;
    align-items: center;
  }
  
  &-right { gap: 8px; }
  
  &-indicator {
    display: flex;
    align-items: center;
    gap: 6px;
    color: var(--text-secondary);
    
    &.idle { color: var(--text-tertiary); }
    &.busy { color: var(--accent-color); }
    &.retry { color: var(--warning-color); }
  }
  
  &-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
    
    &.pulse { animation: statusPulse 1.5s ease-in-out infinite; }
  }
  
  &-provider {
    color: var(--text-secondary);
    padding: 2px 6px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-sm);
  }
  
  &-model {
    color: var(--text-primary);
    font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
    font-weight: 500;
  }
  
  &-mode {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    margin-left: 8px;
    padding: 2px 8px;
    font-size: 10px;
    font-weight: 600;
    border-radius: 10px;
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    transition: all 0.3s ease;
    
    .mode-icon { font-size: 11px; }
    .mode-label { text-transform: uppercase; letter-spacing: 0.05em; }
    
    &.mode-code { background: rgba(99, 102, 241, 0.15); color: #818cf8; }
    &.mode-plan { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
    &.mode-explore { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
    &.mode-edit { background: rgba(236, 72, 153, 0.15); color: #ec4899; }
    
    &.active {
      animation: modePulse 2s ease-in-out infinite;
      .mode-icon { animation: modeIconBounce 1s ease-in-out infinite; }
    }
  }
}

// --------------------------------------------
// Session Groups
// --------------------------------------------
.session-group {
  border-bottom: 1px solid var(--border-color);
  &:last-child { border-bottom: none; }
  
  &-header {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 10px 16px;
    border: none;
    background: var(--bg-secondary);
    cursor: pointer;
    text-align: left;
    transition: background 0.15s ease;
    
    &:hover { background: var(--bg-tertiary); }
    
    &.active {
      background: var(--bg-tertiary);
      border-left: 2px solid var(--accent-color);
    }
  }
  
  &-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    color: var(--text-tertiary);
    transition: transform 0.15s ease;
    
    &.expanded { transform: rotate(90deg); }
  }
  
  &-info {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 0;
  }
  
  &-name {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  &-count {
    font-size: 10px;
    font-weight: 500;
    color: var(--text-tertiary);
    background: var(--bg-primary);
    padding: 1px 6px;
    border-radius: 10px;
  }
  
  &-stats {
    display: flex;
    gap: 4px;
    flex-shrink: 0;
  }
  
  &-sessions {
    background: var(--bg-primary);
    
    .list-item {
      padding-left: 40px;
      border-bottom: 1px solid var(--border-color);
      &:last-child { border-bottom: none; }
    }
  }
}

// --------------------------------------------
// Context Menu
// --------------------------------------------
.context-menu {
  position: fixed;
  z-index: 1000;
  min-width: 160px;
  background: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-md);
  padding: 4px;
  animation: fadeIn 0.1s ease-out;
  
  &-item {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 8px 10px;
    border: none;
    border-radius: var(--radius-sm);
    background: transparent;
    color: var(--text-primary);
    font-size: 12px;
    text-align: left;
    cursor: pointer;
    transition: background 0.1s ease;
    
    &:hover { background: var(--bg-tertiary); }
    &:disabled { opacity: 0.5; cursor: not-allowed; }
    
    &.danger {
      color: var(--error-color);
      &:hover { background: rgba(239, 68, 68, 0.1); }
      svg { color: var(--error-color); }
    }
    
    svg {
      color: var(--text-secondary);
      flex-shrink: 0;
    }
  }
  
  &-divider {
    height: 1px;
    background: var(--border-color);
    margin: 4px 0;
  }
}

// --------------------------------------------
// Animated Status
// --------------------------------------------
.animated-status {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  font-size: 11px;
  
  .status-text { color: var(--text-tertiary); }
  
  .cursor {
    color: var(--accent-color);
    opacity: 0;
    transition: opacity 0.1s;
    &.visible { opacity: 1; }
  }
  
  .status-label {
    margin-left: 6px;
    color: var(--text-tertiary);
  }
  
  &.retry .status-label { color: var(--warning-color); }
}

// Knight Rider Animation
.knight-rider {
  display: inline-flex;
  gap: 2px;
  align-items: center;
  
  .dot {
    width: 6px;
    height: 6px;
    border-radius: 1px;
    background: var(--text-tertiary);
    opacity: 0.2;
    transition: opacity 0.05s ease, background 0.05s ease;
    
    &.active {
      background: var(--accent-color);
      opacity: 1;
      box-shadow: 0 0 4px var(--accent-color);
    }
    
    &.trail-1 { background: var(--accent-color); opacity: 0.6; }
    &.trail-2 { background: var(--accent-color); opacity: 0.3; }
  }
}

.animated-status.retry .knight-rider .dot {
  &.active {
    background: var(--warning-color);
    box-shadow: 0 0 4px var(--warning-color);
  }
  &.trail-1, &.trail-2 { background: var(--warning-color); }
}

// --------------------------------------------
// Todo List
// --------------------------------------------
.todo-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(2px);
  z-index: 100;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding-top: 48px;
  animation: fadeIn 0.15s ease-out;
}

.todo-panel {
  width: 100%;
  max-width: 360px;
  max-height: calc(100vh - 96px);
  background: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  animation: slideUp 0.2s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.todo-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 14px;
  border-bottom: 1px solid var(--border-color);
  background: var(--bg-secondary);
  
  &-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  &-icon {
    color: var(--accent-color);
  }
  
  h3 {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
  }
}

.todo-close {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border: none;
  background: transparent;
  color: var(--text-tertiary);
  cursor: pointer;
  border-radius: var(--radius-sm);
  transition: all 0.1s ease;
  
  &:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }
}

.todo-progress {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  border-bottom: 1px solid var(--border-color);
  background: var(--bg-secondary);
  
  &-bar {
    flex: 1;
    height: 4px;
    background: var(--bg-tertiary);
    border-radius: 2px;
    overflow: hidden;
  }
  
  &-fill {
    height: 100%;
    background: var(--success-color);
    border-radius: 2px;
    transition: width 0.3s ease;
  }
  
  &-text {
    font-size: 11px;
    color: var(--text-tertiary);
    font-weight: 500;
    white-space: nowrap;
  }
}

.todo-content {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}

.todo-section {
  margin-bottom: 4px;
  
  &:last-child {
    margin-bottom: 0;
  }
  
  &-header {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 8px;
    margin-bottom: 2px;
    border-radius: var(--radius-sm);
    
    svg {
      flex-shrink: 0;
    }
    
    &.in-progress {
      color: var(--accent-color);
      
      svg {
        animation: spin 2s linear infinite;
      }
    }
    
    &.pending {
      color: var(--text-tertiary);
    }
    
    &.completed {
      color: var(--success-color);
    }
    
    &.cancelled {
      color: var(--text-tertiary);
    }
  }
  
  &-title {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  &-count {
    font-size: 10px;
    font-weight: 600;
    padding: 1px 5px;
    border-radius: 10px;
    background: currentColor;
    color: var(--bg-primary);
    margin-left: auto;
  }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.todo-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 8px 10px;
  border-radius: var(--radius-sm);
  margin-left: 8px;
  transition: background 0.1s ease;
  
  &:hover {
    background: var(--bg-secondary);
  }
  
  .status-icon {
    flex-shrink: 0;
    margin-top: 1px;
    
    &.completed {
      color: var(--success-color);
    }
    
    &.in-progress {
      color: var(--accent-color);
      
      svg {
        animation: spin 2s linear infinite;
      }
    }
    
    &.pending {
      color: var(--text-tertiary);
    }
    
    &.cancelled {
      color: var(--text-tertiary);
    }
  }
  
  &-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  
  &.status-completed {
    .todo-content-text {
      color: var(--text-tertiary);
      text-decoration: line-through;
    }
  }
  
  &.status-cancelled {
    .todo-content-text {
      color: var(--text-tertiary);
      text-decoration: line-through;
    }
  }
}

.todo-content-text {
  font-size: 12px;
  color: var(--text-primary);
  line-height: 1.4;
}

.todo-priority {
  display: inline-flex;
  align-self: flex-start;
  font-size: 9px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 4px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  
  &.high {
    background: rgba(239, 68, 68, 0.15);
    color: var(--error-color);
  }
  
  &.medium {
    background: rgba(251, 191, 36, 0.15);
    color: var(--warning-color);
  }
  
  &.low {
    background: rgba(34, 197, 94, 0.15);
    color: var(--success-color);
  }
}

.todo-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  text-align: center;
  
  svg {
    color: var(--text-tertiary);
    opacity: 0.5;
    margin-bottom: 12px;
  }
  
  span {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 4px;
  }
  
  p {
    font-size: 12px;
    color: var(--text-tertiary);
    margin: 0;
  }
}

.todo-footer {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px 14px;
  border-top: 1px solid var(--border-color);
  background: var(--bg-secondary);
}

.todo-stats {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  font-weight: 500;
  color: var(--text-tertiary);
  
  svg {
    color: var(--success-color);
  }
}

// --------------------------------------------
// Update Banner
// --------------------------------------------
.update-banner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px;
  background: linear-gradient(135deg, var(--accent-color) 0%, #2563eb 100%);
  border-bottom: 1px solid var(--border-color);
  gap: 12px;
  
  &-content {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
    min-width: 0;
  }
  
  &-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    flex-shrink: 0;
  }
  
  &-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
    flex: 1;
  }
  
  &-title {
    font-size: 12px;
    font-weight: 600;
    color: white;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  &-subtitle {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.8);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  &-progress {
    width: 100%;
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 4px;
  }
  
  &-progress-bar {
    height: 100%;
    background: white;
    border-radius: 2px;
    transition: width 0.3s ease;
  }
  
  &-actions {
    display: flex;
    gap: 6px;
    flex-shrink: 0;
  }
  
  &-btn {
    padding: 4px 10px;
    font-size: 11px;
    font-weight: 500;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    transition: all 0.15s ease;
    
    &-dismiss {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      &:hover { background: rgba(255, 255, 255, 0.3); }
    }
    
    &-install {
      background: white;
      color: var(--accent-color);
      &:hover { background: rgba(255, 255, 255, 0.9); }
    }
  }
}

// --------------------------------------------
// Selection Mode
// --------------------------------------------
.selection-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
  position: sticky;
  top: 0;
  z-index: 10;
}

.selection-back-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  cursor: pointer;
  border-radius: var(--radius-sm);
  transition: all 0.1s ease;
  margin-left: -4px;
  
  &:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }
}

.selection-count {
  font-size: 12px;
  font-weight: 500;
  color: var(--text-secondary);
}

.selection-btn {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 5px 10px;
  border: none;
  background: var(--bg-tertiary);
  color: var(--text-primary);
  font-size: 11px;
  font-weight: 500;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.1s ease;
  white-space: nowrap;
  
  &:hover {
    background: var(--border-color);
  }
  
  &:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  
  &.danger {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error-color);
    
    &:hover:not(:disabled) {
      background: rgba(239, 68, 68, 0.2);
    }
  }
  
  svg {
    flex-shrink: 0;
    width: 12px;
    height: 12px;
  }
}

.selection-divider {
  width: 1px;
  height: 18px;
  background: var(--border-color);
  margin: 0 4px;
}

.session-checkbox {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  color: var(--accent-color);
  
  svg {
    rect {
      stroke: var(--border-color);
      transition: all 0.1s ease;
    }
  }
  
  .list-item:hover & svg rect {
    stroke: var(--accent-color);
  }
}

.list-item.selected {
  background: rgba(3, 76, 255, 0.08);
  
  .session-checkbox svg rect {
    fill: var(--accent-color);
    stroke: var(--accent-color);
  }
}

.selection-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 16px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
  
  &-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  &-count {
    font-size: 12px;
    color: var(--text-secondary);
  }
  
  &-actions {
    display: flex;
    gap: 6px;
  }
}

.selection-checkbox {
  width: 18px;
  height: 18px;
  border-radius: 4px;
  border: 2px solid var(--border-color);
  background: transparent;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  
  &:hover { border-color: var(--accent-color); }
  
  &.checked {
    background: var(--accent-color);
    border-color: var(--accent-color);
    color: white;
  }
}

// --------------------------------------------
// Syntax Highlighting (Prism)
// --------------------------------------------
.token {
  &.comment, &.prolog, &.doctype, &.cdata { color: #6a9955; }
  &.punctuation { color: #d4d4d4; }
  &.property, &.tag, &.boolean, &.number, &.constant, &.symbol { color: #b5cea8; }
  &.selector, &.attr-name, &.string, &.char, &.builtin { color: #ce9178; }
  &.operator, &.entity, &.url { color: #d4d4d4; }
  &.atrule, &.attr-value, &.keyword { color: #569cd6; }
  &.function, &.class-name { color: #dcdcaa; }
  &.regex, &.important, &.variable { color: #d16969; }
}

// --------------------------------------------
// Utilities
// --------------------------------------------
.text-muted {
  color: var(--text-tertiary);
  font-style: italic;
}

// --------------------------------------------
// Empty State
// --------------------------------------------
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 32px 24px;
  text-align: center;
  
  &-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 80px;
    height: 80px;
    margin-bottom: 16px;
    color: var(--text-tertiary);
    background: var(--bg-tertiary);
    border-radius: 50%;
  }
  
  &-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 8px 0;
  }
  
  &-text {
    font-size: 12px;
    color: var(--text-secondary);
    margin: 0 0 16px 0;
    line-height: 1.5;
    max-width: 240px;
    
    strong { color: var(--accent-color); }
  }
  
  &-btn {
    padding: 8px 16px;
    font-size: 12px;
    font-weight: 500;
    color: white;
    background: var(--accent-color);
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all 0.15s ease;
    
    &:hover {
      filter: brightness(1.1);
    }
  }
}

// --------------------------------------------
// Config Editor
// --------------------------------------------
.config-section {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.config-header {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.config-info {
  display: flex;
  align-items: center;
  gap: 8px;
}

.config-file-icon {
  color: var(--text-secondary);
}

.config-filename {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
}

.config-badge {
  font-size: 9px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 3px;
  text-transform: uppercase;
  
  &.new {
    background: rgba(34, 197, 94, 0.15);
    color: var(--success-color);
  }
  
  &.modified {
    background: rgba(251, 191, 36, 0.15);
    color: var(--warning-color);
  }
}

.config-path {
  font-size: 11px;
  color: var(--text-tertiary);
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, monospace;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.config-error {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  font-size: 12px;
  color: var(--error-color);
  background: rgba(239, 68, 68, 0.1);
  border-radius: var(--radius-sm);
  
  svg { flex-shrink: 0; }
}

.config-editor-wrapper {
  position: relative;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  overflow: hidden;
  background: var(--bg-secondary);
}

.config-editor {
  width: 100%;
  min-height: 280px;
  max-height: 400px;
  padding: 12px;
  font-size: 12px;
  font-family: "IBM Plex Mono", "IBM Plex Mono Fallback", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  line-height: 1.6;
  color: var(--text-primary);
  background: transparent;
  border: none;
  resize: vertical;
  
  &:focus {
    outline: none;
  }
  
  &::placeholder {
    color: var(--text-tertiary);
  }
}

.config-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  padding-top: 4px;
}

.config-btn {
  padding: 8px 16px;
  font-size: 12px;
  font-weight: 500;
  border: none;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.15s ease;
  
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  &.primary {
    background: var(--accent-color);
    color: white;
    
    &:hover:not(:disabled) {
      filter: brightness(1.1);
    }
  }
  
  &.secondary {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    
    &:hover:not(:disabled) {
      background: var(--border-color);
    }
  }
}

// --------------------------------------------
// Permission Popup (Separate Window)
// --------------------------------------------
.permission-popup {
  position: relative;
  display: flex;
  flex-direction: column;
  margin-top: 10px;
  background: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  animation: permissionSlideIn 0.2s ease-out;
  
  // Arrow pointing up (to tray icon)
  &::before {
    content: "";
    position: absolute;
    top: -6px;
    right: 24px;
    width: 12px;
    height: 12px;
    background: var(--bg-primary);
    border-left: 1px solid var(--border-color);
    border-top: 1px solid var(--border-color);
    transform: rotate(45deg);
  }
  
  &::after {
    content: "";
    position: absolute;
    top: 0;
    right: 20px;
    width: 20px;
    height: 10px;
    background: var(--bg-primary);
  }
}

@keyframes permissionSlideIn {
  from {
    opacity: 0;
    transform: translateY(-8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.permission-popup-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px;
  color: var(--text-secondary);
  font-size: 12px;
}

.permission-popup-header {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 14px 16px 10px;
}

.permission-popup-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border-radius: 8px;
  background: rgba(251, 191, 36, 0.15);
  color: var(--warning-color);
  flex-shrink: 0;
  
  svg {
    width: 20px;
    height: 20px;
  }
}

.permission-popup-title {
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
  flex: 1;
  
  h3 {
    margin: 0;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
  }
}

.permission-popup-session {
  font-size: 11px;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.permission-popup-content {
  padding: 0 16px 12px;
}

.permission-popup-type {
  font-size: 11px;
  font-weight: 500;
  color: var(--accent-color);
  margin-bottom: 8px;
  font-family: "IBM Plex Mono", ui-monospace, monospace;
}

.permission-popup-patterns {
  display: flex;
  flex-direction: column;
  gap: 4px;
  
  code {
    display: block;
    padding: 8px 10px;
    font-size: 11px;
    font-family: "IBM Plex Mono", ui-monospace, monospace;
    color: var(--text-primary);
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
}

.permission-popup-more {
  font-size: 10px;
  color: var(--text-tertiary);
  padding-left: 2px;
}

.permission-popup-actions {
  display: flex;
  gap: 8px;
  padding: 12px 16px;
  border-top: 1px solid var(--border-color);
  background: var(--bg-secondary);
}

.permission-btn {
  flex: 1;
  padding: 8px 12px;
  font-size: 12px;
  font-weight: 500;
  border: none;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.15s ease;

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  &.deny {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error-color);

    &:hover:not(:disabled) {
      background: rgba(239, 68, 68, 0.2);
    }
  }

  &.allow-once {
    background: var(--bg-tertiary);
    color: var(--text-primary);

    &:hover:not(:disabled) {
      background: var(--border-color);
    }
  }

  &.allow-always {
    background: var(--accent-color);
    color: white;

    &:hover:not(:disabled) {
      filter: brightness(1.1);
    }
  }
}

// --------------------------------------------
// Compact Mode
// --------------------------------------------
.app.compact-mode {
  // Header
  .header {
    padding: 8px 12px;
    gap: 6px;

    &-btn {
      width: 24px;
      height: 24px;
    }

    &-title {
      font-size: 12px;
    }
  }

  // List items
  .list-item {
    padding: 8px 12px;
    gap: 10px;

    &-icon {
      width: 26px;
      height: 26px;
    }

    &-title {
      font-size: 12px;
    }

    &-subtitle {
      font-size: 10px;
    }
  }

  // Messages
  .message {
    padding: 8px 10px;
    gap: 3px;

    &-role {
      font-size: 10px;
    }

    &-content,
    &-text {
      font-size: 12px;
    }
  }

  // Chat
  .chat {
    &-messages {
      padding: 8px 12px;
      gap: 8px;
    }

    &-input {
      padding: 8px 12px;
      gap: 6px;

      input {
        height: 32px;
        font-size: 12px;
      }
    }
  }

  // Settings
  .settings {
    padding: 8px 12px;

    &-section {
      margin-bottom: 12px;
    }

    &-section-title {
      font-size: 10px;
      margin-bottom: 8px;
    }

    &-item {
      padding: 8px 0;
    }

    &-label,
    &-value {
      font-size: 12px;
    }

    &-tabs {
      padding-bottom: 8px;
      margin-bottom: 8px;
    }

    &-tab {
      padding: 6px 10px;
      font-size: 11px;
    }
  }

  // Tool calls
  .tool-call {
    .tool-header {
      padding: 5px 8px;
      font-size: 11px;
    }

    .tool-output {
      padding: 6px 8px;
      font-size: 10px;
    }
  }

  // Session groups
  .session-group {
    &-header {
      padding: 8px 12px;
    }

    &-name {
      font-size: 11px;
    }

    &-sessions .list-item {
      padding-left: 32px;
    }
  }

  // Diffs
  .diffs {
    padding: 8px;
    gap: 6px;
  }

  .diff-header {
    padding: 8px 10px;
  }

  // Status bar
  .status-bar {
    padding: 4px 10px;
    font-size: 10px;
  }
}
